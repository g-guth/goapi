name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.18

    - name: Build
      run: go build -o ../bin/main.exe -v ./...
      
    - uses: okteto/login@master
      with:
        token: ${{ secrets.OKTETO_TOKEN }}
      
    - name: Kubectl Apply
      # You may pin to the exact commit or the version.
      uses: okteto/apply@v4.2
      with:
        # Path to the Kubernetes manifest. Can be a file or a directory
        manifest: ../charts/templates/deployment.yml
        # If present, the namespace scope for this action. If not specified, it will use the current context
        namespace: g-guth
